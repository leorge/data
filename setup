myName=`basename $0`; REPO=data; INSTALLER=inst_cmd; BIN=~/bin; NULL=/dev/null
if [ -d .git ]; then  # in a git repository
    repository=`grep "url = " .git/config | sed 's#.*/\(.*\)\.git#\1#'`
    if [ $repository != $REPO ]; then
        echo This repository \"$repository\" is wrong.
        exit 1
    elif which $INSTALLER > $NULL; then
        $INSTALLER git && git pull
        addpath $PWD                    # a script "addpath" should be also installed
    else
        cd .. && bash $0    # call again
    fi
elif ! which $INSTALLER > $NULL; then   # ~/bin is absent in $PATH
    if [ -x $BIN/$INSTALLER ]; then
        PATH=$PATH:$BIN; bash $0
    else
        echo "Please download my scripts."
        echo "Visit https://github.com/leorge/scripts and read the README.md below in the page."
        echo "Please logout and login again."
    fi
elif [ -d $REPO ]; then # Scripts maybe in the sub-directory.
    pushd $REPO && bash $myName && popd && rm -f $myName
elif $INSTALLER git; then   # not in a repository
    git clone https://github.com/leorge/$REPO.git && \
    addpath $PWD/$REPO && rm -f $myName
else
    ERR=$?
    echo "You can not install both git and unzip." >&2
    echo "Please clone the repository \"$REPO\" under another operating system, then retry." >&2
    exit $ERR
fi
